var array_unique_noempty,element_box;jQuery(function(e){function s(s){e("option",r).each(function(){var n=e("#"+e(this).val().toLowerCase()+"_desc").closest("table"),t=n.prev("h2");e(this).val()==s?(n.show(),t.show(),a(n,!0)):(n.hide(),t.hide(),a(n,!1))})}function n(s){switch(s){case"YWSN_Jazz":e("#ywsn_from_number").parent().parent().hide(),e("#ywsn_from_asid").parent().parent().hide();break;default:e("#ywsn_from_number").parent().parent().show(),e("#ywsn_from_asid").parent().parent().show()}}function a(s,n){e("input",s).each(function(){e(this).prop("required",n)})}var t={};e(".checkbox-column a").click(function(s){s.preventDefault();var n=e(this).attr("id").replace("-lnk",""),a="."+n+"-cb";n in t&&0!=t[n]?(e(a).prop("checked",!1),t[n]=!1):(e(a).prop("checked",!0),t[n]=!0)});var r=e("#ywsn_sms_gateway");"undefined"!=typeof r&&(s(r.val()),n(r.val())),r.on("change",function(){s(r.val()),n(r.val())}),e(document).ready(function(){"use strict";function s(s){var n=e("#ywsn_checkout_checkbox_value"),a=e("#ywsn_checkout_checkbox_text");n.parent().parent().parent().css("paddingTop","0").css("paddingBottom","0"),"requested"==s?(n.parent().parent().parent().parent().show(),a.parent().parent().show(),e(".ywsn-checkout-option").parent().parent().parent().parent().parent().css("paddingBottom","0")):(n.parent().parent().parent().parent().hide(),a.parent().parent().hide(),e(".ywsn-checkout-option").parent().parent().parent().parent().parent().css("paddingBottom","20px"))}e("#ywsn_url_shortening").change(function(){var s=e("option:selected",this).val(),n=e("#ywsn_google_api_key"),a=e("#ywsn_bitly_access_token");switch(s){case"bitly":a.parent().parent().show(),a.prop("required",!0),n.parent().parent().hide(),n.prop("required",!1);break;case"google":a.parent().parent().hide(),a.prop("required",!1),n.parent().parent().show(),n.prop("required",!0);break;default:a.parent().parent().hide(),a.prop("required",!1),n.parent().parent().hide(),n.prop("required",!1)}}).change(),e("#ywsn_sms_test_message").change(function(){var s=e("option:selected",this).val();"write-sms"==s?e(".ywsn-write-sms").show():e(".ywsn-write-sms").hide()}).change(),e(".ywsn-custom-message").on("change keyup input",function(){var s=e(this).val().length,n=160-s;e(".ywsn-char-count").find("span").text(n),0>n?e(".ywsn-char-count").addClass("maxed-out"):e(".ywsn-char-count").removeClass("maxed-out")}),e(".ywsn-checkout-option").each(function(){e(this).is(":checked")&&s(e(this).val())}).click(function(){s(e(this).val())}),element_box.init()}),e("body").on("click","button.ywsn-send-test-sms",function(){var s=e(".ywsn-send-result"),n=e(".ywsn-test-sms").val(),a=e("#ywsn_sms_test_message_country").val(),t=e("#ywsn_sms_test_message").val(),r=e(".forminp-custom-send"),c="";if(r.addClass("processing"),r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),s.show(),s.removeClass("send-progress send-fail send-success"),""==t)return s.addClass("send-fail"),s.html(ywsn_admin.sms_no_message),void r.removeClass("processing").unblock();switch(t){case"write-sms":c=e(".ywsn-custom-message").val();break;default:c=e("#ywsn_message_"+t).val()}if(""==c)return s.addClass("send-fail"),s.html(ywsn_admin.sms_empty_message),void r.removeClass("processing").unblock();if(""==n)return s.addClass("send-fail"),s.html(ywsn_admin.sms_wrong),void r.removeClass("processing").unblock();var i={action:"ywsn_send_sms",phone:n,message:c,country:a};s.addClass("send-progress"),s.html(ywsn_admin.sms_before_send),e.post(ywsn_admin.ajax_url,i,function(e){s.removeClass("send-progress"),r.removeClass("processing").unblock(),e.success===!0?(s.addClass("send-success"),s.html(ywsn_admin.sms_after_send)):(s.addClass("send-fail"),s.html(e.error))})}).on("click","button.ywsn-send-sms",function(){var s=e(".ywsn-send-result"),n=e(".ywsn-sms-metabox"),a=e("#_ywsn_receive_sms").is(":checked"),t=e(".ywsn-custom-message").val();if(n.addClass("processing"),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),"requested"==ywsn_admin.sms_customer_notification&&!a&&!window.confirm(ywsn_admin.sms_manual_send_advice))return void n.removeClass("processing").unblock();if(s.show(),s.removeClass("send-progress send-fail send-success"),""==t)return s.addClass("send-fail"),s.html(ywsn_admin.sms_empty_message),void n.removeClass("processing").unblock();var r={action:"ywsn_send_sms",order_id:ywsn_admin.order_id,message:t};s.addClass("send-progress"),s.html(ywsn_admin.sms_before_send),e.post(ywsn_admin.ajax_url,r,function(a){s.removeClass("send-progress"),n.removeClass("processing").unblock(),a.success===!0?(s.addClass("send-success"),s.html(ywsn_admin.sms_after_send)):(s.addClass("send-fail"),s.html(a.error)),e("ul.order_notes").prepend(a.note),e(".ywsn-custom-message").val("")})}),array_unique_noempty=function(s){var n=[];return e.each(s,function(s,a){a=e.trim(a),a&&-1===e.inArray(a,n)&&n.push(a)}),n},element_box={clean:function(e){return e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(s){var n=s.id,a=n.split("-check-num-")[1],t=e(s).closest(".ywcc-checklist-div"),r=t.find(".ywcc-values"),c=r.val().split(","),i=[];return delete c[a],e.each(c,function(s,n){n=e.trim(n),n&&i.push(n)}),r.val(this.clean(i.join(","))),this.quickClicks(t),!1},quickClicks:function(s){var n,a=e(".ywcc-values",s),t=e(".ywcc-value-list ul",s),r=e(s).attr("id");a.length&&(n=a.val().split(","),t.empty(),e.each(n,function(s,n){var a,c;n=e.trim(n),n&&(a=e('<li class="select2-search-choice" />'),c=e('<a id="'+r+"-check-num-"+s+'" class="select2-search-choice-close" tabindex="0"></a>'),c.on("click keypress",function(s){("click"===s.type||13===s.keyCode)&&(13===s.keyCode&&e(this).closest(".ywcc-checklist-div").find("input.ywcc-insert").focus(),element_box.parseTags(this))}),a.prepend('<div><div class="selected-option" data-id="'+n+'">'+n+"</div></div>").prepend(c),t.append(a))}))},flushTags:function(s,n,a){var t,r,c,i=e(".ywcc-values",s),o=e("input.ywcc-insert",s);return n=n||!1,c=n?e(n).text():o.val(),"undefined"==typeof c?!1:(t=i.val(),r=t?t+","+c:c,r=this.clean(r),r=array_unique_noempty(r.split(",")).join(","),i.val(r),this.quickClicks(s),n||o.val(""),"undefined"==typeof a&&o.focus(),!1)},init:function(){var s=e(".ywcc-checklist-ajax");e(".ywcc-checklist-div").each(function(){element_box.quickClicks(this)}),e("input.ywcc-insert",s).keyup(function(s){return 13==s.which?(element_box.flushTags(e(this).closest(".ywcc-checklist-div")),!1):void 0}).keypress(function(e){return 13==e.which?(e.preventDefault(),!1):void 0})}}});