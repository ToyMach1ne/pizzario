jQuery(document).ready(function(a){"use strict";var b=a(document).find(".ywdpd-sections-group"),c=b.find(".ywdpd-section"),d=c.find(".ywdpd-section-head"),e=d.find(".ywdpd-remove"),f=d.find(".ywdpd-clone"),g=d.find(".ywdpd-active"),h=c.find(".yith-ywdpd-eventype-select"),i="undefined"!=typeof yith_ywdpd_admin&&yith_ywdpd_admin.block_loader,j="undefined"!=typeof yith_ywdpd_admin&&yith_ywdpd_admin.error_msg,k="undefined"!=typeof yith_ywdpd_admin&&yith_ywdpd_admin.del_msg,l=yith_ywdpd_admin.ajaxurl+"?action=ywdpd_admin_action",m=a("#yith-ywdpd-add-section"),n=a("#yith-ywdpd-add-section-button"),o=function(b){b.on("click",function(){var b=a(this);b.parents(".ywdpd-section").toggleClass("open"),b.next(".section-body").slideToggle()})},p=function(b){b.on("click",function(b){b.stopPropagation();var c=a(this),d=c.data("section"),e=c.parents(".ywdpd-section"),f=window.confirm(k);1==f&&(i&&e.block({message:null,overlayCSS:{background:"#fff url("+i+") no-repeat center",opacity:.5,cursor:"none"}}),a.post(l,{ywdpd_action:"section_remove",section:d},function(a){e.remove()}))})},q=function(c){c.off().on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(this),f=(d.data("section"),d.parents(".ywdpd-section-handle")),g=d.parents(".ywdpd-section"),h="section_clone",i=g.find(".ywdpd-active"),j=i.data("section"),k=f.clone();a.post(l,{ywdpd_action:h,cloned_from:j},function(c){if(c.key){var d=k.html(),e='<div class="ywdpd-section-handle" data-key="'+c.key+'">',f=a(e+d.replace(RegExp(j,"g"),c.key)+"</div>");b.append(f),g=a(document).find(".ywdpd-sections-group").find(".ywdpd-section").last();var h=a(g).find(".ywdpd-section-head"),i=g.find(".yith-ywdpd-eventype-select"),l=g.find(".ywdpd-active"),m=g.find(".ywdpd-clone"),n=g.find(".ywdpd-remove");g.removeClass("open"),g.find("select").chosenDestroy(),g.find("select").chosen({width:"100%",disable_search:!0}),o(h),s(i),p(n),q(m),r(l),g.find(".ajax_chosen_select_vendors").each(function(){x(a(this))}),g.find(".ajax_chosen_select_brands").each(function(){y(a(this))}),g.find(".ajax_chosen_select_categories").each(function(){v(a(this))}),g.find(".ajax_chosen_select_tags").each(function(){w(a(this))}),g.find(".ajax_chosen_select_products").each(function(){u(a(this))}),g.find(".ajax_chosen_select_customers").each(function(){z(a(this))}),g.find(".datepicker").removeClass("hasDatepicker").removeData("datepicker").unbind().each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1})}})})},r=function(b){b.on("click",function(b){b.stopPropagation();var c=a(this),d=c.data("section"),e=c.parents(".ywdpd-section"),f=c.parents(".ywdpd-section-head").find(".active-hidden-field");c.hasClass("activated")?f.val("no"):f.val("yes"),i&&e.block({message:null,overlayCSS:{background:"#fff url("+i+") no-repeat center",opacity:.5,cursor:"none"}}),a.post(l,{ywdpd_action:"section_active",section:d,active:f.val()},function(a){"yes"==a?c.addClass("activated"):c.removeClass("activated"),e.unblock()})})},s=function(b){b.each(function(){var b=a(this),c=b.data("field"),d=b.find("option:selected");t(b,d.val(),c),b.on("change",function(){var a=b.data("field"),c=b.find("option:selected");t(b,c.val(),a)})})},t=function(b,c,d){var e=b.closest(".ywdpd-select-wrapper").find("tr.deps-"+d);e.each(function(){var b=a(this).data("type").split(";");if(a.inArray(c,b)!==-1)a(this).show();else if(a(this).hide(),"undefined"!=typeof a(this).data("rel")){var d="deps-"+a(this).data("rel");a(this).parents(".ywdpd-section").find("."+d).hide()}})},u=function(b){b.ajaxChosen({method:"GET",url:yith_ywdpd_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"woocommerce_json_search_products_and_variations",security:yith_ywdpd_admin.search_products_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},v=function(b){b.ajaxChosen({method:"GET",url:l,dataType:"json",afterTypeDelay:100,data:{ywdpd_action:"category_search",security:yith_ywdpd_admin.search_categories_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},w=function(b){b.ajaxChosen({method:"GET",url:l,dataType:"json",afterTypeDelay:100,data:{ywdpd_action:"tag_search",security:yith_ywdpd_admin.search_tags_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},x=function(b){b.ajaxChosen({method:"GET",url:yith_ywdpd_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywdpd_vendor_search",security:yith_ywdpd_admin.search_vendor_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},y=function(b){b.ajaxChosen({method:"GET",url:yith_ywdpd_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywdpd_brand_search",security:yith_ywdpd_admin.search_brand_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})},z=function(b){b.ajaxChosen({method:"GET",url:l,dataType:"json",afterTypeDelay:100,data:{ywdpd_action:"customers_search",security:yith_ywdpd_admin.search_customers_nonce}},function(b){var c={};return a.each(b,function(a,b){c[a]=b}),c})};n.on("click",function(c){c.preventDefault();var d=a(this),e=d.data("section_id"),f=d.data("section_name"),g=d.data("action"),h=d.data("type"),i=m.val();""==i?j&&d.siblings(".ywdpd-error-input-section").html(j):a.post(l,{ywdpd_action:g,type:h,section:i,id:e,name:f},function(c){m.val(""),a(".ywdpd-error-input-section").remove(),b.append(c);var d=b.find(".ywdpd-section").last(),e=a(d).find(".ywdpd-section-head"),f=d.find(".yith-ywdpd-eventype-select"),g=d.find(".ywdpd-active"),h=d.find(".ywdpd-clone"),i=d.find(".ywdpd-remove");d.find("select").chosen({width:"100%",disable_search:!0}),o(e),s(f),p(i),q(h),r(g),d.find(".ajax_chosen_select_vendors").each(function(){x(a(this))}),d.find(".ajax_chosen_select_brands").each(function(){y(a(this))}),d.find(".ajax_chosen_select_categories").each(function(){v(a(this))}),d.find(".ajax_chosen_select_tags").each(function(){w(a(this))}),d.find(".ajax_chosen_select_products").each(function(){u(a(this))}),d.find(".ajax_chosen_select_customers").each(function(){z(a(this))}),d.find(".datepicker").each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1})})}),a(document).on("click",".upload_img_button",function(b){b.preventDefault();var d,c=a(this);return d?void d.open():(d=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1}),d.on("select",function(){var a=d.state().get("selection").first().toJSON(),b=c.prev(".upload_img_url");b.val(a.url)}),void d.open())}),a(document).on("click",".add-row",function(){var b=a(this),c=b.closest("table"),d=b.closest("tr"),e=parseInt(d.data("index")),f=d.clone(),g=c.find("tr"),h=1;g.each(function(){var b=a(this).data("index");b>h&&(h=b)});var i=h+1;f.attr("data-index",i);var j=f.find("[name*='rules']");j.each(function(){var b=a(this),c=b.attr("name"),d=b.attr("id"),f=c.replace("[rules]["+e+"]","[rules]["+i+"]"),g=d.replace("[rules]["+e+"]","[rules]["+i+"]");b.attr("name",f),b.attr("id",g),b.val("")}),f.find(".remove-row").removeClass("hide-remove"),f.find(".chosen-container").remove(),f.find("select").chosen({width:"100%",disable_search:!1}),c.append(f);var k=f.find(".yith-ywdpd-eventype-select"),l=f;l.find(".ajax_chosen_select_vendors").each(function(){x(a(this))}),l.find(".ajax_chosen_select_brands").each(function(){y(a(this))}),l.find(".ajax_chosen_select_categories").each(function(){v(a(this))}),l.find(".ajax_chosen_select_tags").each(function(){w(a(this))}),l.find(".ajax_chosen_select_products").each(function(){u(a(this))}),l.find(".ajax_chosen_select_customers").each(function(){z(a(this))}),s(k)}),a(document).on("click",".remove-row",function(){var b=a(this),c=b.closest("tr");c.remove()}),jQuery(".ywdpd-sections-group").sortable({items:".ywdpd-section-handle",cursor:"move",axis:"y",handle:"form",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(b,c){c.item.removeAttr("style");var d=a(".ywdpd-section-handle"),e=0,f=new Array;for(e=0;e<d.length;e++)f[e]=a(d[e]).data("key");f.length>0&&a.post(l,{ywdpd_action:"order_section",tab:a(".form-table").closest(".yit-admin-panel-content-wrap-full").data("type"),order_keys:f},function(a){})}}),o(d),p(e),q(f),r(g),s(h),c.find(".ajax_chosen_select_vendors").each(function(){x(a(this))}),c.find(".ajax_chosen_select_brands").each(function(){y(a(this))}),c.find(".ajax_chosen_select_categories").each(function(){v(a(this))}),c.find(".ajax_chosen_select_tags").each(function(){w(a(this))}),c.find(".ajax_chosen_select_products").each(function(){u(a(this))}),c.find(".ajax_chosen_select_customers").each(function(){z(a(this))}),c.find("select").chosen({width:"100%",disable_search:!1}),c.find(".datepicker").each(function(){a(this).prop("placeholder","YYYY-MM-DD HH:mm")}).datetimepicker({timeFormat:"HH:mm",defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1}),a.fn.chosenDestroy=function(){return a(this).show().removeClass("chzn-done"),a(this).next().remove(),a(this)}});